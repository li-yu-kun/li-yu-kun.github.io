<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          JAVA面试干货之Java底层GC - 李玉坤 | Blog
        
    </title>

    <link rel="canonical" href="https://li-yu-kun.github.io/article/JAVA面试干货之Java底层GC/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/article_header/article_bg.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                        </div>
                        <h1>JAVA面试干货之Java底层GC</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by 李玉坤 on
                            2020-04-26
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">李玉坤</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="对象被判定为垃圾的标准"><a href="#对象被判定为垃圾的标准" class="headerlink" title="对象被判定为垃圾的标准"></a>对象被判定为垃圾的标准</h1><ul>
<li>没有被其他对象引用<h1 id="判定对象是否为垃圾的算法"><a href="#判定对象是否为垃圾的算法" class="headerlink" title="判定对象是否为垃圾的算法"></a>判定对象是否为垃圾的算法</h1><h2 id="引用计数算法"><a href="#引用计数算法" class="headerlink" title="引用计数算法"></a>引用计数算法</h2>判断对象的引用数量</li>
<li>通过判断对象的引用数量来决定对象是否可以被回收</li>
<li>每个对象实例都有一个引用计数器，被引用则+1，完成引用则-1</li>
<li>任何引用计数为0的对象实例可以被当作垃圾收集</li>
</ul>
<p>优点：</p>
<ul>
<li>执行效率高，程序执行受影响较小</li>
</ul>
<p>缺点：</p>
<ul>
<li>无法检测出循环引用的情况，导致内存泄漏<br>下列代码就是循环引用对方对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> MyObject childNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReferenceCounterProblem</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyObject object1 = <span class="keyword">new</span> MyObject();</span><br><span class="line">        MyObject object2 = <span class="keyword">new</span> MyObject();</span><br><span class="line"></span><br><span class="line">        object1.childNode = object2;</span><br><span class="line">        object2.childNode = object1;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="可达性分析算法"><a href="#可达性分析算法" class="headerlink" title="可达性分析算法"></a>可达性分析算法</h2><p>通过判断对象的引用链是否可达来决定对象是否可以被回收<br><img src="1.png" alt=""></p>
<ul>
<li>可以作为GC Root的对象<ul>
<li>虚拟机栈中引用的对象（栈帧中的本地变量表）</li>
<li>方法区中的常量引用的对象</li>
<li>方法区中的类静态属性引用的对象</li>
<li>本地方法栈中JNI（Native方法）的引用对象</li>
<li>活跃线程的引用对象</li>
</ul>
</li>
</ul>
<h1 id="谈谈你了解的垃圾回收算法"><a href="#谈谈你了解的垃圾回收算法" class="headerlink" title="谈谈你了解的垃圾回收算法"></a>谈谈你了解的垃圾回收算法</h1><h2 id="标记-清除算法（Mark-and-Sweep）"><a href="#标记-清除算法（Mark-and-Sweep）" class="headerlink" title="标记 - 清除算法（Mark and Sweep）"></a>标记 - 清除算法（Mark and Sweep）</h2><ul>
<li>标记：从根集合进行扫描，对存活的对象进行标记</li>
<li>清除：对堆内存从头到尾进行线性遍历，回收不可达对象内存</li>
</ul>
<p>标记 - 清除算法会产生不连续的内存碎片，即照成碎片化；在有新的较大对象进来时，无法找到连续的空间，只能被迫提前促发另一次垃圾清除操作。<br><img src="2.png" alt=""></p>
<h2 id="复制算法"><a href="#复制算法" class="headerlink" title="复制算法"></a>复制算法</h2><ul>
<li>分为对象面和空闲面</li>
<li>对象在对象面上创建</li>
<li>存活的对象被从对象面复制到空闲面</li>
<li>将对象面所有对象内存清除</li>
</ul>
<p>其他</p>
<ul>
<li>解决碎片化问题</li>
<li>顺序分配内存，简单高效</li>
<li>适用于对象存活率低的场景<br><img src="3.png" alt=""><h2 id="标记-整理算法（Compacting）"><a href="#标记-整理算法（Compacting）" class="headerlink" title="标记 - 整理算法（Compacting）"></a>标记 - 整理算法（Compacting）</h2></li>
<li>标记：从根集合进行扫描，对存活的对象进行标记</li>
<li>清除：移动所有存活的对象，且按照内存地址次序依次排列，然后将末端内存地址以后的内存全部回收</li>
</ul>
<p>其他</p>
<ul>
<li><p>避免内存的不连续性</p>
</li>
<li><p>不用设置两块内存互换</p>
</li>
<li><p>适用于存活率高的场景<br><img src="4.png" alt=""></p>
<h2 id="分代收集算法（Generational-Collector）"><a href="#分代收集算法（Generational-Collector）" class="headerlink" title="分代收集算法（Generational Collector）"></a>分代收集算法（Generational Collector）</h2></li>
<li><p>垃圾回收算法的组合拳</p>
</li>
<li><p>按照对象生命周期的不同划分区域以采用不同的垃圾回收算法</p>
</li>
<li><p>目的：提高JVM的垃圾回收效率</p>
</li>
<li><p>jdk6，jdk7<br><img src="5.png" alt=""></p>
</li>
<li><p>jdk8+<br><img src="6.png" alt=""><br>老年代存活率高用标记清除或标记整理，年轻代存活率低用复制</p>
</li>
<li><p>分代收集的GC分类</p>
<ul>
<li>Minor GC 发生在年轻代中的垃圾收集动作，采用的时复制算法，执行频率高；年轻代java对象出生的地方，java对象的申请内存以及存放都是在年轻代；java中大部分对象都不会长久存活，新生代是垃圾收集的频繁区域。<ul>
<li>Eden区满了会促发Minor GC</li>
</ul>
</li>
<li>Full GC  发生在老年代，比Minor GC慢，但执行频率低；<ul>
<li>老年代空间不足，（1.8之前的永久代不足），</li>
<li>CMS GC时出现promotion failed,concurrent mode failure，</li>
<li>Minor GC晋升到老年代的平均大小大于老年代的剩余空间，</li>
<li>调用System.gc()，只是提醒虚拟机回收一下对象，决定权取决于虚拟机</li>
<li>使用RMI来进行RPC或管理的JDK应用，每小时执行一次Full GC</li>
<li>以上这些都会促发Full GC<h3 id="年轻代"><a href="#年轻代" class="headerlink" title="年轻代"></a>年轻代</h3><img src="7.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li><p>年轻代：尽可能快速地收集掉那些生命周期短的对象</p>
<ul>
<li>Eden区 ：Eden区代表起源，对象刚被创建的出生地</li>
<li>两个Survivor区：from区和to区（不确定区分哪个是from和to）</li>
</ul>
</li>
</ul>
<p><strong>年轻代垃圾回收的过程演示</strong><br>假定Eden区最多可以保存四个对象，每个Survivor区可以保存3个对象。</p>
<p><img src="8.png" alt=""><br>1、对象出生会挤满Eden区，促发Minor GC；将存活对象放入from区<br><img src="9.png" alt=""><br>2、清理所有使用过的Eden区，将存活对象的年龄设置为1<br><img src="10.png" alt=""><br>3、假设Eden区再次被填满<br><img src="11.png" alt=""><br>4、促发Minor GC；将存活对象（Eden和S0的存活对象）放入from区。S1变成了from，S0变成了to。同时对这些对象年龄加1。<br><img src="12.png" alt=""><br>5、之后Eden和S0都会被清空<br><img src="13.png" alt=""><br>6、假设Eden区第三次被填满，此时S1里有一个对象时无用的。<br><img src="14.png" alt=""><br>7、存活对象将会被拷贝到S0中，并且对这些对象年龄加1。<br><img src="15.png" alt=""><br>8、S1和Eden再次被清空；周而复始，当对象的年龄达到15（参数-XX:MaxTenuringThreshold默认为15），会被放入老年代；但是也不是绝对的，当出现一个新的很大的对象，Eden和S区都装不下的时候，会被直接送入老年代<br><img src="16.png" alt=""><br><strong>对象如何晋升到老年代</strong></p>
<ul>
<li>经历一定Minor次数（15次）依然存活的对象</li>
<li>Survivor区中存放不下的对象</li>
<li>新生成的大对象（-XX:+PretenuerSizeThreshold）</li>
</ul>
<h3 id="常用调优参数"><a href="#常用调优参数" class="headerlink" title="常用调优参数"></a>常用调优参数</h3><ul>
<li>-XX:SurvivorRatio:Eden和Survivor的比值，默认8：1</li>
<li>-XX:NewRatio:老年代和年轻代内存大小的比例</li>
<li>-XX:MaxTenuringThreshold:对象从年轻代晋升到老年代经过GC的最大阈值</li>
</ul>
<h3 id="老年代"><a href="#老年代" class="headerlink" title="老年代"></a>老年代</h3><p>存放生命周期较长的对象</p>
<ul>
<li>标记-清理算法</li>
<li>标记-整理算法<h3 id="Stop-the-World"><a href="#Stop-the-World" class="headerlink" title="Stop-the-World"></a>Stop-the-World</h3></li>
<li>JVM由于要执行GC而停止了应用程序的执行</li>
<li>任何一种GC算法中都会发生</li>
<li>多数GC优化通过减少Stop-the-world发生的时间来提高程序性能<h3 id="Safepoint"><a href="#Safepoint" class="headerlink" title="Safepoint"></a>Safepoint</h3></li>
<li>分析过程中对象引用关系不会发生变化的点</li>
<li>产生Safepoint的地方：方法调用；循环跳转；异常跳转等</li>
<li>安全点数量得适中<h1 id="常见得垃圾收集器"><a href="#常见得垃圾收集器" class="headerlink" title="常见得垃圾收集器"></a>常见得垃圾收集器</h1>JVM的运行模式</li>
<li>Server 服务端启动较慢，启动之后的长期运行中，程序运行快</li>
<li>Client 客户端启动较快，启动之后的长期运行中，程序运行慢</li>
<li>执行java -version就可以查看运行模式<h2 id="垃圾收集器之间的联系"><a href="#垃圾收集器之间的联系" class="headerlink" title="垃圾收集器之间的联系"></a>垃圾收集器之间的联系</h2>图中连线是表示兼容，可以一块使用。<br><img src="17.png" alt=""><h2 id="年轻代常见的垃圾收集器"><a href="#年轻代常见的垃圾收集器" class="headerlink" title="年轻代常见的垃圾收集器"></a>年轻代常见的垃圾收集器</h2><h3 id="Serial收集器（-XX-UseSerialGC，复制算法）"><a href="#Serial收集器（-XX-UseSerialGC，复制算法）" class="headerlink" title="Serial收集器（-XX:+UseSerialGC，复制算法）"></a>Serial收集器（-XX:+UseSerialGC，复制算法）</h3></li>
<li>单线程收集，进行垃圾收集时，必须暂停所有工作线程</li>
<li>简单高效，Client模式下默认得年轻代收集器</li>
</ul>
<p>可以在几十~100毫秒收集一两百兆的垃圾<br><img src="18.png" alt=""></p>
<h3 id="ParNew收集器（-XX：-UseParNewGC，复制算法）"><a href="#ParNew收集器（-XX：-UseParNewGC，复制算法）" class="headerlink" title="ParNew收集器（-XX：+UseParNewGC，复制算法）"></a>ParNew收集器（-XX：+UseParNewGC，复制算法）</h3><ul>
<li>多线程收集，其余的行为、特点和Serial收集器一样</li>
<li>单核执行效率不如Serial，在多核下执行才有优势</li>
</ul>
<p>默认开启的线程数与CPU数量相同<br><img src="19.png" alt=""></p>
<h3 id="Parallel-Scavenge收集器（-XX：-UseParallelGC，复制算法）"><a href="#Parallel-Scavenge收集器（-XX：-UseParallelGC，复制算法）" class="headerlink" title="Parallel Scavenge收集器（-XX：+UseParallelGC，复制算法）"></a>Parallel Scavenge收集器（-XX：+UseParallelGC，复制算法）</h3><ul>
<li>吞吐量=运行用户代码时间/（运行用户代码时间+垃圾收集时间）</li>
<li>比起关注用户线程停顿时间，更关注系统的吞吐量</li>
<li>在多核下执行才有优势，Server模式下默认的年轻代收集器</li>
</ul>
<p>在启动中加入图中的参数会把调优交给虚拟机去完成</p>
<p><img src="20.png" alt=""></p>
<h2 id="老年代常见的垃圾收集器"><a href="#老年代常见的垃圾收集器" class="headerlink" title="老年代常见的垃圾收集器"></a>老年代常见的垃圾收集器</h2><h3 id="Serial-Old收集器（-XX：-UseSerialOldGC，标记-整理算法）"><a href="#Serial-Old收集器（-XX：-UseSerialOldGC，标记-整理算法）" class="headerlink" title="Serial Old收集器（-XX：+UseSerialOldGC，标记-整理算法）"></a>Serial Old收集器（-XX：+UseSerialOldGC，标记-整理算法）</h3><ul>
<li>单线程收集，进行垃圾收集时，必须暂停所有工作线程</li>
<li>简单高效，Client模式下默认的老年代收集器<br><img src="21.png" alt=""><h3 id="Parallel-Old收集器（-XX：-UseParallelOldGC，标记-整理算法）jdk6之后"><a href="#Parallel-Old收集器（-XX：-UseParallelOldGC，标记-整理算法）jdk6之后" class="headerlink" title="Parallel Old收集器（-XX：+UseParallelOldGC，标记-整理算法）jdk6之后"></a>Parallel Old收集器（-XX：+UseParallelOldGC，标记-整理算法）jdk6之后</h3></li>
<li>多线程，吞吐量优先<br><img src="22.png" alt=""><h3 id="CMS收集器（-XX：-UseConcMarkSweepGC，标记-清除算法）"><a href="#CMS收集器（-XX：-UseConcMarkSweepGC，标记-清除算法）" class="headerlink" title="CMS收集器（-XX：+UseConcMarkSweepGC，标记-清除算法）"></a>CMS收集器（-XX：+UseConcMarkSweepGC，标记-清除算法）</h3></li>
<li><strong>初始标记：stop-the-world</strong></li>
<li>并发标记：并发追溯标记，程序不会停顿</li>
<li>并发预清理：查找执行并发标记阶段从年轻代晋升到老年代的对象</li>
<li><strong>重新标记：暂停虚拟机，扫描CMS堆中的剩余对象</strong></li>
<li>并发清理：清理垃圾对象，程序不会停顿</li>
<li>并发重置：重置CMS收集器的数据结构<br><img src="23.png" alt=""><h2 id="G1收集器（-XX：-UseG1GC，复制-标记-整理算法）"><a href="#G1收集器（-XX：-UseG1GC，复制-标记-整理算法）" class="headerlink" title="G1收集器（-XX：+UseG1GC，复制+标记-整理算法）"></a>G1收集器（-XX：+UseG1GC，复制+标记-整理算法）</h2>Garbage First收集器的优点：</li>
<li>并行和并发</li>
<li>分代收集</li>
<li>空间整合</li>
<li>可预测的停顿</li>
</ul>
<p>其他</p>
<ul>
<li>将整个Java堆内存划分成多个大小相等的Region</li>
<li>年轻代和老年代不再物理隔离<br><img src="24.png" alt=""><h1 id="GC相关的面试题"><a href="#GC相关的面试题" class="headerlink" title="GC相关的面试题"></a>GC相关的面试题</h1><h2 id="Object的finalize-方法的作用是否与C-的析构函数作用相同"><a href="#Object的finalize-方法的作用是否与C-的析构函数作用相同" class="headerlink" title="Object的finalize()方法的作用是否与C++的析构函数作用相同"></a>Object的finalize()方法的作用是否与C++的析构函数作用相同</h2></li>
<li>与C++的析构函数不同，析构函数调用确定，而它的是不确定的</li>
<li>将未被引用的对象放置于F-Queue队列</li>
<li>方法执行随时可能会被终止</li>
<li>给予对象最后一次重生的机会</li>
</ul>
<p>以下程序说明不建议使用finalize()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.ref.ReferenceQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Finalization</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Finalization finalization;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finalize</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Finalized"</span>);</span><br><span class="line">        finalization = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Finalization f = <span class="keyword">new</span> Finalization();</span><br><span class="line">        System.out.println(<span class="string">"First print: "</span> + f);</span><br><span class="line">        f = <span class="keyword">null</span>;</span><br><span class="line">        System.gc();</span><br><span class="line">        <span class="keyword">try</span> &#123;<span class="comment">// 休息一段时间，让上面的垃圾回收线程执行完成</span></span><br><span class="line">            Thread.currentThread().sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"Second print: "</span> + f);</span><br><span class="line">        System.out.println(f.finalization);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//不加try的运行结果</span></span><br><span class="line">First print: com.kun.Finalization@<span class="number">677327</span>b6</span><br><span class="line">Finalized</span><br><span class="line">Second print: <span class="keyword">null</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line"><span class="comment">//加try的运行结果</span></span><br><span class="line">First print: com.kun.Finalization@<span class="number">677327</span>b6</span><br><span class="line">Finalized</span><br><span class="line">Second print: <span class="keyword">null</span></span><br><span class="line">com.kun.Finalization@<span class="number">677327</span>b6</span><br></pre></td></tr></table></figure>
<h2 id="Java中的强引用、软引用、弱引用、虚引用有什么作用"><a href="#Java中的强引用、软引用、弱引用、虚引用有什么作用" class="headerlink" title="Java中的强引用、软引用、弱引用、虚引用有什么作用"></a>Java中的强引用、软引用、弱引用、虚引用有什么作用</h2><ul>
<li>强引用（Strong Reference）<ul>
<li>最普遍的引用：Object obj=new Object()</li>
<li>抛出OutOfMemoryError终止程序也不会回收具有强引用的对象</li>
<li>通过将对象设置为null来弱化引用，使其被回收</li>
</ul>
</li>
<li>软引用（Soft Reference）<ul>
<li>对象处在有用但非必须的状态</li>
<li>只有当内存空间不足时，GC会回收该引用的对象的内存</li>
<li>可以用来实现高速缓存</li>
</ul>
</li>
</ul>
<p><img src="25.png" alt=""></p>
<ul>
<li>弱引用（Weak Reference）<ul>
<li>非必须的对象，比软引用更弱一些</li>
<li>GC时会被回收</li>
<li>被回收的概率也不大，因为GC线程优先级比较低</li>
<li>适用于引用偶尔被使用且不影响垃圾收集的对象</li>
</ul>
</li>
</ul>
<p><img src="26.png" alt=""></p>
<ul>
<li>虚引用（Phantom Reference）<ul>
<li>不会决定对象的生命周期</li>
<li>任何时候都可能被垃圾收集器回收</li>
<li>跟踪对象被垃圾收集器回收的活动，起哨兵作用</li>
<li>必须和引用队列ReferenceQueue联合使用</li>
</ul>
</li>
</ul>
<p><img src="27.png" alt=""></p>
<p><img src="28.png" alt=""></p>
<h3 id="类层次结构"><a href="#类层次结构" class="headerlink" title="类层次结构"></a>类层次结构</h3><p><img src="29.png" alt=""></p>
<h3 id="引用队列（ReferenceQueue）"><a href="#引用队列（ReferenceQueue）" class="headerlink" title="引用队列（ReferenceQueue）"></a>引用队列（ReferenceQueue）</h3><ul>
<li>无实际存储结构，存储逻辑依赖于内部节点之间的关系来表达</li>
<li>存储关联的且被GC的软引用，弱引用以及虚引用</li>
</ul>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/article/JAVA面试干货之Java底层JVM/" data-toggle="tooltip" data-placement="top" title="JAVA面试干货之Java底层JVM">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/article/[Kettle]09 九、kettle统计-映射-脚本控件/" data-toggle="tooltip" data-placement="top" title="[Kettle]09 九、kettle统计-映射-脚本控件">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>


<!-- chrome Firefox 中文锚点定位失效-->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<!-- smooth scroll behavior polyfill  -->
<script type="text/javascript" src="/js/smoothscroll.js"></script>
<script>
        $('#toc').on('click','a',function(a){
            // var isChrome = window.navigator.userAgent.indexOf("Chrome") !== -1;
            // console.log(window.navigator.userAgent,isChrome)
                // if(isChrome) {
                    // console.log(a.currentTarget.outerHTML);
                    // console.log($(a.currentTarget).attr("href"));
                    //跳转到指定锚点
                    // document.getElementById(a.target.innerText.toLowerCase()).scrollIntoView(true);
                    document.getElementById($(a.currentTarget).attr("href").replace("#","")).scrollIntoView({behavior: 'smooth' });
                // }
        })  
</script>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/li-yu-kun">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 李玉坤 2020 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    By <a href="https://li-yu-kun.github.io/">李玉坤</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=li-yu-kun&repo=li-yu-kun.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://li-yu-kun.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'xxx';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>





	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://li-yu-kun.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
